#include "../definiciones.h"
#include "../Funciones_TPI.h"
#include "../ejercicios.h"
#include "../auxiliares.h"
#include "gtest/gtest.h"
#include <iostream>
#include <string>

using namespace std;

TEST(muestraHomogeneaTEST, unaSolucionDe4) {
    vector <hogar> res = {{2354, 2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
                          {1,    2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
                          {4377, 2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
                          {340,  2018, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1}};
    eph_h th = {
            {960,  2018, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1},
            {340,  2018, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1},
            {1009, 2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {210,  2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {4377, 2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {200,  2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {334,  2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {543,  2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {2354, 2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
            {1,    2018, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1},
    };

    eph_i ti = {{543,   2018, 1, 1, 1, 1, 36, 1,  3, 1, 1}, // 1
                {334,   2018, 1, 1, 1, 1, 36, 1,  3, 90, 1},
                {340,   2018, 1, 1, 1, 1, 36, 1,  3, 30, 1}, // 35
                {340,   2018, 3, 1, 1, 1, 36, 1,  3, 5, 1},
                {334,   2018, 2, 1, 1, 1, 31, 1,  3, 90, 1},
                {1009,  2018, 1, 1, 1, 2, 36, 1,  3, 26, 1}, // 26
                {210,   2018, 1, 1, 1, 1, 36, 1,  1, 25, 1}, // 27
                {210,   2018, 2, 1, 1, 1, 36, 1,  3, 2, 1},
                {1,     2018, 1, 1, 1, 2, 5,  1,  2, 25, 1},  // 25
                {4377,  2018, 1, 1, 1, 1, 36, 1,  3, 15, 1}, // 30
                {4377,  2018, 3, 1, 1, 1, 7,  1,  3, 15, 1},
                {2354,  2018, 1, 1, 1, 2, 36, 1,  3, 20, 1}, // 20
                {200,   2018, 2, 1, 1, 1, 36, 1,  3, 0, 1}, // 0
                {960,   2018, 3, 1, 1, 2, 51, 1,  4, 0,  1}, // 0
                {960,   2018, 2, 1, 1, 2, 51, 1,  4, 0,  1},
                {960,   2018, 1, 1, 1, 2, 51, 1,  4, 0,  1}
    };
    EXPECT_EQ(res,muestraHomogenea(th,ti));
}

TEST(muestraHomogeneaTEST, dosSolucionesDe3) {
    vector <hogar> res1 = {{1,    2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
                           {210,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
                           {340,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1}};

    vector <hogar> res2 = {{1,    2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
                           {210,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
                           {4377, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1}};

    eph_h th = {
            {960,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {340,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {1009, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {210,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {4377, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {200,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {334,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {543,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2354, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {1,    2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {800,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
    };

    eph_i ti = {{543,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1}, // 1
                {334,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1}, // 3
                {334,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1},
                {340,  2018, 1, 1, 1, 1, 36, 1,  3, 30,  1},  // 30
                {340,  2018, 3, 1, 1, 1, 36, 1,  3, 0,  1},
                {1009, 2018, 1, 1, 1, 1, 36, 1,  3, 26,  1}, // 26
                {210,  2018, 1, 1, 1, 1, 36, 1,  3, 25,  1}, // 27
                {210,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1},
                {1,    2018, 1, 1, 1, 1, 36, 1,  3, 24,  1}, // 24
                {4377, 2018, 1, 1, 1, 1, 36, 1,  3, 15,  1}, // 30
                {4377, 2018, 3, 1, 1, 1, 36, 1,  3, 15,  1},
                {2354, 2018, 1, 1, 1, 1, 36, 1,  3, 20,  1}, // 20
                {800,  2018, 2, 1, 1, 1, 36, 1,  3, 0,  1}, // 0
                {200,  2018, 2, 1, 1, 1, 36, 1,  3, 0,  1}, // 0
                {960,  2018, 3, 1, 1, 2, 51, 1,  4, 0,   1}, // 0
                {960,  2018, 2, 1, 1, 2, 51, 1,  4, 0,   1},
                {960,  2018, 1, 1, 1, 2, 51, 1,  4, 0,   1}};
    vector <hogar> propuesto = muestraHomogenea(th,ti);
    bool esperado = res1 == propuesto || res2 == propuesto;
    EXPECT_EQ(true,esperado);
}


// UDEF

TEST(muestraHomogeneaTEST, mejorSolucion) {
    eph_h th = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {5,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {6,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {8,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {9,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
    };

    eph_i ti = {
            {1,  2018, 1, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {2,  2018, 3, 1, 1, 2, 51, 1,  4, 2,  1},
            {2,  2018, 2, 1, 1, 2, 51, 1,  4, 2,  1},
            {2,  2018, 1, 1, 1, 2, 51, 1,  4, 2,  1}, //6
            {3,  2018, 1, 1, 1, 1, 36, 1,  3, 4,  1},
            {3,  2018, 3, 1, 1, 1, 36, 1,  3, 4,  1}, //8
            {4,  2018, 1, 1, 1, 1, 36, 1,  3, 10, 1}, //10
            {5,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {5,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //3
            {6,  2018, 1, 1, 1, 1, 36, 1,  3, 7,  1},
            {6,  2018, 3, 1, 1, 1, 36, 1,  3, 6,  1}, //13
            {7,  2018, 2, 1, 1, 1, 36, 1,  3, 4,  1}, //4
            {8,  2018, 1, 1, 1, 1, 36, 1,  3, 3,  1},
            {8,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //5
            {9,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1}, //1
            {10, 2018, 1, 1, 1, 1, 36, 1,  3, 12, 1}, //12
            {11, 2018, 2, 1, 1, 1, 36, 1,  3, 14,  1}, //14
    };
    // 1, 2, 3, 4, 5, 6, 8, 10, 12, 13, 14
    // -> 1, 2, 3, 4, 5, 6
    // -> 2, 4, 6, 8, 10, 12, 14
    vector<hogar> res = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1}
    };
    vector <hogar> propuesto = muestraHomogenea(th,ti);
    EXPECT_EQ(propuesto, res);
}

TEST(muestraHomogeneaTEST, sinSolucionDeLargo3) {
    eph_h th = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {5,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {6,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {8,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {9,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
    };

    eph_i ti = {
            {1,  2018, 1, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {2,  2018, 3, 1, 1, 2, 51, 1,  4, 2,  1},
            {2,  2018, 2, 1, 1, 2, 51, 1,  4, 2,  1},
            {2,  2018, 1, 1, 1, 2, 51, 1,  4, 4,  1}, //8
            {3,  2018, 1, 1, 1, 1, 36, 1,  3, 8,  1},
            {3,  2018, 3, 1, 1, 1, 36, 1,  3, 8,  1}, //16
            {4,  2018, 1, 1, 1, 1, 36, 1,  3, 32, 1}, //32
            {5,  2018, 1, 1, 1, 1, 36, 1,  3, 4,  1},
            {5,  2018, 2, 1, 1, 1, 36, 1,  3, 60,  1}, //64
            {6,  2018, 1, 1, 1, 1, 36, 1,  3, 64,  1},
            {6,  2018, 3, 1, 1, 1, 36, 1,  3, 64,  1}, //128
            {7,  2018, 2, 1, 1, 1, 36, 1,  3, 4,  1}, //4
            {8,  2018, 1, 1, 1, 1, 36, 1,  3, 3,  1},
            {8,  2018, 2, 1, 1, 1, 36, 1,  3, 256,  1}, //256
            {9,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1}, //1
            {10, 2018, 1, 1, 1, 1, 36, 1,  3, 512, 1}, //512
            {11, 2018, 2, 1, 1, 1, 36, 1,  3, 1024,  1}, //1024
    };
    // 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024

    vector<hogar> res = {};
    vector <hogar> propuesto = muestraHomogenea(th,ti);
    EXPECT_EQ(propuesto, res);
}

TEST(muestraHomogeneaTEST, diferenciasConstantes) {
    eph_h th = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {5,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {6,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {8,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {9,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
    };

    eph_i ti = {
            {1,  2018, 1, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {2,  2018, 3, 1, 1, 2, 51, 1,  4, 1,  1},
            {2,  2018, 2, 1, 1, 2, 51, 1,  4, 1,  1},
            {2,  2018, 1, 1, 1, 2, 51, 1,  4, 0,  1}, //2
            {3,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {3,  2018, 3, 1, 1, 1, 36, 1,  3, 1,  1}, //2
            {4,  2018, 1, 1, 1, 1, 36, 1,  3, 2, 1}, //2
            {5,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {5,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //3
            {6,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {6,  2018, 3, 1, 1, 1, 36, 1,  3, 2,  1}, //3
            {7,  2018, 2, 1, 1, 1, 36, 1,  3, 4,  1}, //4
            {8,  2018, 1, 1, 1, 1, 36, 1,  3, 3,  1},
            {8,  2018, 2, 1, 1, 1, 36, 1,  3, 3,  1}, //3
            {9,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1}, //1
            {10, 2018, 1, 1, 1, 1, 36, 1,  3, 3, 1}, //3
            {11, 2018, 2, 1, 1, 1, 36, 1,  3, 3,  1}, //3
    };
    // 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4
    // -> 1, 2, 3, 4
    vector <hogar> propuesto = muestraHomogenea(th,ti);
    ASSERT_TRUE(propuesto.size() == 4);
    EXPECT_EQ(propuesto[0], th[8]);
    EXPECT_TRUE(
            propuesto[1] == th[0] ||
            propuesto[1] == th[1] ||
            propuesto[1] == th[2] ||
            propuesto[1] == th[3]);
    EXPECT_TRUE(
            propuesto[2] == th[4] ||
            propuesto[2] == th[5] ||
            propuesto[2] == th[7] ||
            propuesto[2] == th[9] ||
            propuesto[2] == th[10]);
    EXPECT_EQ(propuesto[3], th[6]);
}

TEST(muestraHomogeneaTEST, todoConstante) {
    eph_h th = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {5,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {6,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {8,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {9,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
    };

    eph_i ti = {
            {1,  2018, 1, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {2,  2018, 3, 1, 1, 2, 51, 1,  4, 1,  1},
            {2,  2018, 2, 1, 1, 2, 51, 1,  4, 1,  1},
            {2,  2018, 1, 1, 1, 2, 51, 1,  4, 0,  1}, //2
            {3,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {3,  2018, 3, 1, 1, 1, 36, 1,  3, 1,  1}, //2
            {4,  2018, 1, 1, 1, 1, 36, 1,  3, 2, 1}, //2
            {5,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {5,  2018, 2, 1, 1, 1, 36, 1,  3, 1,  1}, //2
            {6,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {6,  2018, 3, 1, 1, 1, 36, 1,  3, 1,  1}, //2
            {7,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {8,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {8,  2018, 2, 1, 1, 1, 36, 1,  3, 1,  1}, //2
            {9,  2018, 1, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {10, 2018, 1, 1, 1, 1, 36, 1,  3, 2, 1}, //2
            {11, 2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //2
    };
    vector<hogar> res;
    vector<hogar> propuesto = muestraHomogenea(th,ti);
    EXPECT_EQ(propuesto, res);
}

TEST(muestraHomogeneaTEST, noConsideraIngresoNaN) {
    eph_h th = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {5,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {6,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {8,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {9,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
    };

    eph_i ti = {
            {1,  2018, 1, 1, 1, 1, 36, 1,  3, 2,  1}, //2
            {2,  2018, 3, 1, 1, 2, 51, 1,  4, 2,  1},
            {2,  2018, 2, 1, 1, 2, 51, 1,  4, 2,  1},
            {2,  2018, 1, 1, 1, 2, 51, 1,  4, 2,  1}, //6
            {3,  2018, 1, 1, 1, 1, 36, 1,  3, -1,  1}, // ! no cuenta como ingreso
            {3,  2018, 3, 1, 1, 1, 36, 1,  3, 8,  1}, //8
            {4,  2018, 1, 1, 1, 1, 36, 1,  3, 10, 1}, //10
            {5,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1},
            {5,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //3
            {6,  2018, 1, 1, 1, 1, 36, 1,  3, 7,  1},
            {6,  2018, 3, 1, 1, 1, 36, 1,  3, 6,  1}, //13
            {7,  2018, 2, 1, 1, 1, 36, 1,  3, 4,  1}, //4
            {8,  2018, 1, 1, 1, 1, 36, 1,  3, 3,  1},
            {8,  2018, 2, 1, 1, 1, 36, 1,  3, 2,  1}, //5
            {9,  2018, 1, 1, 1, 1, 36, 1,  3, 1,  1}, //1
            {10, 2018, 1, 1, 1, 1, 36, 1,  3, 12, 1}, //12
            {11, 2018, 2, 1, 1, 1, 36, 1,  3, 14,  1}, //14
    };
    // 1, 2, 3, 4, 5, 6, 8, 10, 12, 13, 14
    // -> 1, 2, 3, 4, 5, 6
    // -> 2, 4, 6, 8, 10, 12, 14
    vector<hogar> res = {
            {1,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {7,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {2,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {3,  2018, 1, 1, 1, 1, 1, 1, 1, 2,1,1},
            {4,  2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {10, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1},
            {11, 2018, 1, 1, 2, 1, 1, 1, 1, 2,1,1}
    };
    vector <hogar> propuesto = muestraHomogenea(th,ti);
    EXPECT_EQ(propuesto, res);
}