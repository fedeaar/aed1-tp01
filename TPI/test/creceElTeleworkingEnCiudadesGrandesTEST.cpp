#include "../definiciones.h"
#include "../Funciones_TPI.h"
#include "../ejercicios.h"
#include "gtest/gtest.h"
#include <iostream>
#include <string>

using namespace std;

TEST(creceElTeleworkingEnCiudadesGrandesTEST, crece) {


//                                                        +500  Tipo       Lugar para trabajar
//                                                           v   v           v
    eph_h t1h = {{22114, 2018,   3,  319611, 629088, 3,  41, 1,  1,  3,  1,  2}, // Esta no: Sin lugar para trabajar
                {31117, 2018,   3,  332870, 642475, 3,  40, 1,  1,  6,  6,  1},
                {22866, 2018,   3,  317157, 627217, 2,  42, 1,  3,  2,  2,  1},// Esta no: Hotel
                {20957, 2018,   3,  313965, 623297, 1,  43, 0,  1,  3,  1,  1}};// Esta no: menos 500

//                                                                   Ubicación
//                                                                   v
    eph_i t1i = {{20957, 2018,   1,  1,  3,  1,  88, 0,  0,  90000,  1},
                {20957, 2018,   2,  1,  3,  2,  82, 0,  0,  25000,  1},
                {22866, 2018,   1,  0,  3,  1,  31, 1,  3,  59000,  1},
                {22866, 2018,   2,  1,  3,  2,  28, 1,  3,  0,      6}, // Esta no: Hotel
                {31117, 2018,   3,  0,  3,  2,  46, 1,  3,  17000,  1},
                {31117, 2018,   4,  0,  3,  1,  20, 1,  3,  5000,   6},
                {31117, 2018,   5,  0,  3,  2,  15, 0,  0,  5000,   1},
                {22114, 2018,   1,  0,  3,  1,  18, 0,  0,  20000,  1}};


//                                                        +500  Tipo       Lugar para trabajar
//                                                           v   v           v
    eph_h t2h = {{22114, 2020,   3,  319611, 629088, 3,  41, 1,  1,  3,  1,  2}, // Esta no: Sin lugar para trabajar
                {31117, 2020,   3,  332870, 642475, 3,  40, 1,  1,  6,  6,  1},
                {22866, 2020,   3,  317157, 627217, 2,  42, 1,  3,  2,  2,  1},// Esta no: Hotel
                {20957, 2020,   3,  313965, 623297, 1,  43, 0,  1,  3,  1,  1}};// Esta no: menos 500

    eph_i t2i = {{20957, 2020,   1,  1,  3,  1,  88, 0,  0,  90000,  1},
                {20957, 2020,   2,  1,  3,  2,  82, 0,  0,  25000,  1},
                {22866, 2020,   1,  0,  3,  1,  31, 1,  3,  59000,  1},
                {22866, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6}, // Esta no: Hotel
                {31117, 2020,   3,  0,  3,  2,  46, 1,  3,  17000,  1},
                {31117, 2020,   4,  0,  3,  1,  20, 1,  3,  5000,   6},
                {31117, 2020,   5,  0,  3,  2,  15, 1,  0,  5000,   6},
                {22114, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  1}};

    EXPECT_TRUE(esEncuestaValida(t1h, t1i));
    EXPECT_TRUE(esEncuestaValida(t2h, t2i));

    EXPECT_EQ( true, creceElTeleworkingEnCiudadesGrandes(t1h, t1i, t2h, t2i) );
}

TEST(creceElTeleworkingEnCiudadesGrandesTEST, nocrece) {

//                                                        +500  Tipo       Lugar para trabajar
//                                                           v   v           v
    eph_h t1h = {{22114, 2018,   3,  319611, 629088, 3,  41, 1,  1,  3,  1,  2}, // Esta no: Sin lugar para trabajar
                 {31117, 2018,   3,  332870, 642475, 3,  40, 1,  1,  6,  6,  1},
                 {22866, 2018,   3,  317157, 627217, 2,  42, 1,  3,  2,  2,  1},// Esta no: Hotel
                 {20957, 2018,   3,  313965, 623297, 1,  43, 0,  1,  3,  1,  1}};// Esta no: menos 500

//                                                                   Ubicación
//                                                                   v
    eph_i t1i = {{20957, 2018,   1,  1,  3,  1,  88, 0,  0,  90000,  1},
                 {20957, 2018,   2,  1,  3,  2,  82, 0,  0,  25000,  1},
                 {22866, 2018,   1,  0,  3,  1,  31, 1,  3,  59000,  1},
                 {22866, 2018,   2,  1,  3,  2,  28, 1,  3,  0,      6}, // Esta no: Hotel
                 {31117, 2018,   3,  0,  3,  2,  46, 1,  3,  17000,  1},
                 {31117, 2018,   4,  0,  3,  1,  20, 1,  3,  5000,   6},
                 {31117, 2018,   5,  0,  3,  2,  15, 0,  0,  5000,   1},
                 {22114, 2018,   1,  0,  3,  1,  18, 0,  0,  20000,  1}};


//                                                        +500  Tipo       Lugar para trabajar
//                                                           v   v           v
    eph_h t2h = {{22114, 2020,   3,  319611, 629088, 3,  41, 1,  1,  3,  1,  2}, // Esta no: Sin lugar para trabajar
                 {31117, 2020,   3,  332870, 642475, 3,  40, 1,  1,  6,  6,  1},
                 {22866, 2020,   3,  317157, 627217, 2,  42, 1,  3,  2,  2,  1},// Esta no: Hotel
                 {20957, 2020,   3,  313965, 623297, 1,  43, 0,  1,  3,  1,  1}};// Esta no: menos 500

    eph_i t2i = {{20957, 2020,   1,  1,  3,  1,  88, 0,  0,  90000,  1},
                 {20957, 2020,   2,  1,  3,  2,  82, 0,  0,  25000,  1},
                 {22866, 2020,   1,  0,  3,  1,  31, 1,  3,  59000,  1},
                 {22866, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6}, // Esta no: Hotel
                 {31117, 2020,   3,  0,  3,  2,  46, 1,  3,  17000,  1},
                 {31117, 2020,   4,  0,  3,  1,  20, 1,  3,  5000,   6},
                 {31117, 2020,   5,  0,  3,  2,  15, -1,  0,  5000,   6}, // estado no informado
                 {22114, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  1}};

    EXPECT_TRUE(esEncuestaValida(t1h, t1i));
    EXPECT_TRUE(esEncuestaValida(t2h, t2i));

    EXPECT_FALSE(creceElTeleworkingEnCiudadesGrandes(t1h, t1i, t2h, t2i) );
}

TEST(creceElTeleworkingEnCiudadesGrandesTEST, eph2016a2018) {
    eph_h t1h;
    eph_i t1i;
    leerEncuesta ( "eph_3c_2018_1000", t1h, t1i );

    eph_h t2h;
    eph_i t2i;
    leerEncuesta ( "eph_3c_2020_1000", t2h, t2i );

    EXPECT_TRUE(creceElTeleworkingEnCiudadesGrandes(t1h, t1i, t2h, t2i) );
}


/* tests nuevos */

TEST(creceElTeleworkingEnCiudadesGrandesTEST, nadieCumple) {
    eph_h t1h = {
            //COD,  AÑO,  T, LAT,    LONG,   II7, REGION, MAS_500, IV1, IV2, II2, II3
            {1,     2018, 3, 320329, 630940, 1,   43,     1,       1,   3,   2,   2},
            {2,     2018, 3, 324550, 634357, 1,   44,     0,       1,   3,   2,   2},
            {3,     2018, 3, 329513, 639028, 1,   40,     0,       1,   5,   4,   2},
            {4,     2018, 3, 330602, 640796, 3,   40,     1,       1,   4,   2,   2},
            {5,     2018, 3, 336594, 646969, 1,   40,     1,       1,   2,   2,   2}
    };
    eph_i t1i = {
            //COD,  AÑO,  COMP, NIVEL_ED, T, CH4, CH6, ESTADO, CAT_OCUP, P47T,  PP04G
            {1,     2018, 1,    1,        3, 2,   61,  0,      3,        59000, 1},
            {1,     2018, 1,    1,        3, 2,   54,  0,      3,        20000, 1},
            {1,     2018, 1,    0,        3, 2,   50,  0,      3,        10000, 0},
            {2,     2018, 2,    0,        3, 1,   47,  0,      3,        10000, 5},
            {2,     2018, 3,    0,        3, 1,   27,  0,      1,        18000, 8},
            {3,     2018, 4,    0,        3, 1,   26,  0,      3,        16000, 5},
            {4,     2018, 5,    0,        3, 2,   19,  0,      0,        0    , 10},
            {4,     2018, 6,    0,        3, 2,   3,   0,      0,        0    , 10},
            {4,     2018, 1,    0,        3, 2,   60,  0,      0,        6000 , 10},
            {5,     2018, 2,    0,        3, 1,   71,  0,      0,        7000 , 10}
    };
    eph_h t2h = {
            //COD,  AÑO,  T, LAT,    LONG,   II7, REGION, MAS_500, IV1, IV2, II2, II3
            {1,     2019, 3, 320329, 630940, 1,   43,     1,       1,   3,   2,   2},
            {2,     2019, 3, 324550, 634357, 1,   44,     0,       1,   3,   2,   2},
            {3,     2019, 3, 329513, 639028, 1,   40,     0,       1,   5,   4,   2},
            {4,     2019, 3, 330602, 640796, 3,   40,     1,       1,   4,   2,   2},
            {5,     2019, 3, 336594, 646969, 1,   40,     1,       1,   2,   2,   2}
    };
    eph_i t2i = {
            //COD,  AÑO,  COMP, NIVEL_ED, T, CH4, CH6, ESTADO, CAT_OCUP, P47T,  PP04G
            {1,     2019, 1,    1,        3, 2,   61,  0,      3,        59000, 1},
            {1,     2019, 1,    1,        3, 2,   54,  0,      3,        20000, 1},
            {1,     2019, 1,    0,        3, 2,   50,  0,      3,        10000, 0},
            {2,     2019, 2,    0,        3, 1,   47,  0,      3,        10000, 5},
            {2,     2019, 3,    0,        3, 1,   27,  0,      1,        18000, 8},
            {3,     2019, 4,    0,        3, 1,   26,  0,      3,        16000, 5},
            {4,     2019, 5,    0,        3, 2,   19,  0,      0,        0    , 10},
            {4,     2019, 6,    0,        3, 2,   3,   0,      0,        0    , 10},
            {4,     2019, 1,    0,        3, 2,   60,  0,      0,        6000 , 10},
            {5,     2019, 2,    0,        3, 1,   71,  0,      0,        7000 , 10}
    };

    EXPECT_EQ(false, creceElTeleworkingEnCiudadesGrandes(t1h, t1i, t2h, t2i));
}

TEST(creceElTeleworkingEnCiudadesGrandesTEST, nadieTeletrabaja) {
    eph_h t1h = {
            //COD,  AÑO,  T, LAT,    LONG,   II7, REGION, MAS_500, IV1, IV2, II2, II3
            {1,     2018, 3, 320329, 630940, 1,   43,     1,       1,   3,   2,   2},
            {2,     2018, 3, 324550, 634357, 1,   44,     0,       1,   3,   2,   2},
            {3,     2018, 3, 329513, 639028, 1,   40,     0,       1,   5,   4,   2},
            {4,     2018, 3, 330602, 640796, 3,   40,     1,       2,   4,   2,   2},
            {5,     2018, 3, 336594, 646969, 1,   40,     1,       2,   2,   2,   2}
    };
    eph_i t1i = {
            //COD,  AÑO,  COMP, NIVEL_ED, T, CH4, CH6, ESTADO, CAT_OCUP, P47T,  PP04G
            {1,     2018, 1,    1,        3, 2,   61,  1,      3,        59000, 6},
            {1,     2018, 1,    1,        3, 2,   54,  1,      3,        20000, 6},
            {1,     2018, 1,    0,        3, 2,   50,  1,      3,        10000, 0},
            {2,     2018, 2,    0,        3, 1,   47,  1,      3,        10000, 5},
            {2,     2018, 3,    0,        3, 1,   27,  1,      1,        18000, 8},
            {3,     2018, 4,    0,        3, 1,   26,  1,      3,        16000, 5},
            {4,     2018, 5,    0,        3, 2,   19,  1,      0,        0    , 6},
            {4,     2018, 6,    0,        3, 2,   3,   1,      0,        0    , 6},
            {4,     2018, 1,    0,        3, 2,   60,  1,      0,        6000 , 6},
            {5,     2018, 2,    0,        3, 1,   71,  1,      0,        7000 , 10}
    };
    eph_h t2h = {
            //COD,  AÑO,  T, LAT,    LONG,   II7, REGION, MAS_500, IV1, IV2, II2, II3
            {1,     2019, 3, 320329, 630940, 1,   43,     1,       1,   3,   2,   1},
            {2,     2019, 3, 324550, 634357, 1,   44,     0,       1,   3,   2,   1},
            {3,     2019, 3, 329513, 639028, 1,   40,     0,       1,   5,   4,   1},
            {4,     2019, 3, 330602, 640796, 3,   40,     1,       2,   4,   2,   1},
            {5,     2019, 3, 336594, 646969, 1,   40,     1,       2,   2,   2,   1}
    };
    eph_i t2i = {
            //COD,  AÑO,  COMP, NIVEL_ED, T, CH4, CH6, ESTADO, CAT_OCUP, P47T,  PP04G
            {1,     2019, 1,    1,        3, 2,   61,  1,      3,        59000, 4},
            {1,     2019, 1,    1,        3, 2,   54,  1,      3,        20000, 3},
            {1,     2019, 1,    0,        3, 2,   50,  1,      3,        10000, 0},
            {2,     2019, 2,    0,        3, 1,   47,  1,      3,        10000, 5},
            {2,     2019, 3,    0,        3, 1,   27,  1,      1,        18000, 8},
            {3,     2019, 4,    0,        3, 1,   26,  1,      3,        16000, 5},
            {4,     2019, 5,    0,        3, 2,   19,  1,      0,        0    , 2},
            {4,     2019, 6,    0,        3, 2,   3,   1,      0,        0    , 1},
            {4,     2019, 1,    0,        3, 2,   60,  1,      0,        6000 , 1},
            {5,     2019, 2,    0,        3, 1,   71,  1,      0,        7000 , 10}
    };

    EXPECT_EQ(false, creceElTeleworkingEnCiudadesGrandes(t1h, t1i, t2h, t2i));
}

TEST(creceElTeleworkingEnCiudadesGrandesTEST, mismoPorcentaje) {
    eph_h t1h = {
            //COD,  AÑO,  T, LAT,    LONG,   II7, REGION, MAS_500, IV1, IV2, II2, II3
            {1,     2018, 3, 320329, 630940, 1,   43,     1,       1,   3,   2,   1},
            {2,     2018, 3, 324550, 634357, 1,   44,     0,       1,   3,   2,   1},
            {3,     2018, 3, 329513, 639028, 1,   40,     0,       1,   5,   4,   1},
            {4,     2018, 3, 330602, 640796, 3,   40,     1,       2,   4,   2,   1},
            {5,     2018, 3, 336594, 646969, 1,   40,     1,       2,   2,   2,   1}
    };
    eph_i t1i = {
            //COD,  AÑO,  COMP, NIVEL_ED, T, CH4, CH6, ESTADO, CAT_OCUP, P47T,  PP04G
            {1,     2018, 1,    1,        3, 2,   61,  1,      3,        59000, 6},
            {1,     2018, 1,    1,        3, 2,   54,  1,      3,        20000, 6},
            {1,     2018, 1,    0,        3, 2,   50,  1,      3,        10000, 0},
            {2,     2018, 2,    0,        3, 1,   47,  1,      3,        10000, 5},
            {2,     2018, 3,    0,        3, 1,   27,  1,      1,        18000, 8},
            {3,     2018, 4,    0,        3, 1,   26,  1,      3,        16000, 6},
            {4,     2018, 5,    0,        3, 2,   19,  1,      0,        0    , 6},
            {4,     2018, 6,    0,        3, 2,   3,   1,      0,        0    , 6},
            {4,     2018, 1,    0,        3, 2,   60,  1,      0,        6000 , 6},
            {5,     2018, 2,    0,        3, 1,   71,  1,      0,        7000 , 6}
    };
    eph_h t2h = {
            //COD,  AÑO,  T, LAT,    LONG,   II7, REGION, MAS_500, IV1, IV2, II2, II3
            {1,     2019, 3, 320329, 630940, 1,   43,     1,       1,   3,   2,   1},
            {2,     2019, 3, 324550, 634357, 1,   44,     0,       1,   3,   2,   1},
            {3,     2019, 3, 329513, 639028, 1,   40,     0,       1,   5,   4,   1},
            {4,     2019, 3, 330602, 640796, 3,   40,     1,       2,   4,   2,   1},
            {5,     2019, 3, 336594, 646969, 1,   40,     1,       2,   2,   2,   1}
    };
    eph_i t2i = {
            //COD,  AÑO,  COMP, NIVEL_ED, T, CH4, CH6, ESTADO, CAT_OCUP, P47T,  PP04G
            {1,     2019, 1,    1,        3, 2,   61,  1,      3,        59000, 6},
            {1,     2019, 1,    1,        3, 2,   54,  1,      3,        20000, 6},
            {1,     2019, 1,    0,        3, 2,   50,  1,      3,        10000, 0},
            {2,     2019, 2,    0,        3, 1,   47,  1,      3,        10000, 5},
            {2,     2019, 3,    0,        3, 1,   27,  1,      1,        18000, 8},
            {3,     2019, 4,    0,        3, 1,   26,  1,      3,        16000, 6},
            {4,     2019, 5,    0,        3, 2,   19,  1,      0,        0    , 6},
            {4,     2019, 6,    0,        3, 2,   3,   1,      0,        0    , 6},
            {4,     2019, 1,    0,        3, 2,   60,  1,      0,        6000 , 6},
            {5,     2019, 2,    0,        3, 1,   71,  1,      0,        7000 , 6}
    };

    EXPECT_EQ(false, creceElTeleworkingEnCiudadesGrandes(t1h, t1i, t2h, t2i));
}

